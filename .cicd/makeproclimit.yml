env:
  BUILD_TIMEOUT: 120
  TEST_TIMEOUT: 60
  TIMEOUT: 120
  VERBOSE: true

steps:

  - trigger: "eosio-base-images-beta"
    label: ":docker: Ensure base images exist"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - wait

  - label: ":aws: [Amazon] 2 Build"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-amazonlinux-2-54e7d492dd0bdfae4e1ffbc4070ebfc1918c5249"
          environment:
            - "MAKE_PROC_LIMIT"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_AMAZON_LINUX_2

  - label: ":centos: [CentOS] 7 Build"
    command:
      - ""
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-centos-7-7fcd4f1fb0a252ba81bcabaef57d0e26a371ac3c"
          environment:
            - "MAKE_PROC_LIMIT"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_CENTOS_7

  - label: ":ubuntu: [Ubuntu] 16.04 Build"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-ubuntu-16.04-e90950002595c0a757f40e7e5446ae17cdc13ac9"
          environment:
            - "MAKE_PROC_LIMIT"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_UBUNTU_16

  - label: ":ubuntu: [Ubuntu] 18.04 Build"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-ubuntu-18.04-03c080d7a404043feb3f33d4fb6da0e81225ef17"
          environment:
            - "MAKE_PROC_LIMIT"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_UBUNTU_18
