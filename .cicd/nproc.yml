env:
  BUILD_TIMEOUT: 120
  TEST_TIMEOUT: 60
  TIMEOUT: 120
  VERBOSE: true

steps:
  - trigger: "eosio-base-images-beta"
    label: ":docker: Ensure base images exist"
    build:
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"

  - wait

  - label: ":aws: [Amazon] 2 Build"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-amazonlinux-2-316efdf69bdf206d33a085adc5f3417729c240f1"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_AMAZON_LINUX_2

  - label: ":centos: [CentOS] 7 Build"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-centos-7-5439ba983e48f62def8015a286690130dd86ccea"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_CENTOS_7

  - label: ":ubuntu: [Ubuntu] 16.04 Build"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-ubuntu-16.04-c61a03f418bf32b4a353e01b6b38fd22a38151f3"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_UBUNTU_16

  - label: ":ubuntu: [Ubuntu] 18.04 Build"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-ubuntu-18.04-697aa59dddda9b803a75275442041d2302b38e9d"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_UBUNTU_18

  - label: ":aws: [Amazon] 2 Build 2"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-amazonlinux-2-9b47693c41ecdf8a0546da9f937bc6ae5202dd66"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_AMAZON_LINUX_2

  - label: ":centos: [CentOS] 7 Build 2"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-centos-7-a39edc35545632a7d9b0798d88831d703ac07df1"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_CENTOS_7

  - label: ":ubuntu: [Ubuntu] 16.04 Build 2"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-ubuntu-16.04-260bb69006f82adf7ae33ea215f77d7eabb56289"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_UBUNTU_16

  - label: ":ubuntu: [Ubuntu] 18.04 Build 2"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-ubuntu-18.04-ca8436b076ee2c04a1163fd58cf9190c51816094"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_UBUNTU_18

  - label: ":aws: [Amazon] 2 Build 3"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-amazonlinux-2-9b47693c41ecdf8a0546da9f937bc6ae5202dd66"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_AMAZON_LINUX_2

  - label: ":centos: [CentOS] 7 Build 3"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-centos-7-a39edc35545632a7d9b0798d88831d703ac07df1"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_CENTOS_7

  - label: ":ubuntu: [Ubuntu] 16.04 Build 3"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-ubuntu-16.04-260bb69006f82adf7ae33ea215f77d7eabb56289"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_UBUNTU_16

  - label: ":ubuntu: [Ubuntu] 18.04 Build 3"
    agents:
      queue: "automation-eos-docker-eof-fleet"
    plugins:
      - docker#v3.3.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-ubuntu-18.04-ca8436b076ee2c04a1163fd58cf9190c51816094"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_UBUNTU_18